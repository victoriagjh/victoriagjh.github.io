---
title:  "Node For Docker"
date: 2020-12-01 19:22:00
description: Inflearn
categories: [docker]
resource: true
comments: true
---

# Node For Docker
## Node.js ì•± ë§Œë“¤ê¸°
- package.json
  - í”„ë¡œì íŠ¸ì˜ ì •ë³´ì™€ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ì¤‘ì¸ íŒ¨í‚¤ì§€ì˜ ì˜ì¡´ì„±ì„ ê´€ë¦¬í•˜ëŠ” ê³³
- server.js
  - ì‹œì‘ì (Entry-Point)ìœ¼ë¡œì„œ ê°€ì¥ ë¨¼ì € ì‹œì‘ë˜ëŠ” íŒŒì¼

### package.json ë§Œë“¤ê¸°
> {  <br>
  "name": "node", <br>
  "version": "1.0.0", <br>
  "description": "", <br>
  "main": "index.js", <br>
  "scripts": { <br>
    "test": "echo \"Error: no test specified\" && exit 1", <br>
    "start": "node server.js" <br>
  }, <br>
  "author": "", <br>
  "license": "ISC", <br>
  "dependencies": { <br>
    "express": "^4.17.1" <br>
  } <br>
}

### server.js ë§Œë“¤ê¸°
> // server.js <br>
// express ëª¨ë“ˆì„ ë¶ˆëŸ¬ì˜¨ë‹¤! <br>
const express = require('express'); <br>
<br>
// express PORT ì„¤ì •ê°’ <br>
const PORT = 8080; <br>
// express í˜¸ìŠ¤íŠ¸ ì£¼ì†Œ <br>
const HOST = '0.0.0.0'; <br>
<br>
// express class ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤. <br>
const app = express(); <br>
<br>
// get method ì„¤ì •! <br>
app.get('/', (req, res) => { <br>
  res.send('hello World'); <br>
}); <br>
<br>
// í•´ë‹¹ ì„œë²„ì˜ í¬íŠ¸ ë° í˜¸ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒ. <br>
app.listen(PORT, HOST); <br>
<br>
// ë‹¨ìˆœ ë¡œê·¸ë¥¼ ë‚¨ê²¨ë³´ì! <br>
console.log(`Running on http:://${HOST}:${PORT}`); <br>

## Docker íŒŒì¼ ì‘ì„±í•˜ê¸°
> FROM node:10  <br>
RUN npm install  <br>
CMD ["node", "server.js"]  <br>

### alpine ëŒ€ì‹  nodeë¥¼ ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¡œ ì“°ëŠ” ì´ìœ 
- alpine ì´ë¯¸ì§€ëŠ” ê°€ì¥ ìµœì†Œí•œì˜ ê²½ëŸ‰í™”ëœ íŒŒì¼ë“¤ì´ ë“¤ì–´ìˆìŒ
- npmì„ ìœ„í•œ íŒŒì¼ì´ ë“¤ì–´ìˆì§€ ì•Šì•„ì„œ RUN ë¶€ë¶„ì— npm installì„ í•  ìˆ˜ê°€ ì—†ìŒ
- npmì´ ìˆëŠ” ë² ì´ìŠ¤ ì´ë¯¸ì¦ˆ ì¤‘ í•˜ë‚˜ê°€ node ì´ë¯¸ì§€ì„

### npm installì´ë€?
- npmì€ node.jsë¡œ ë§Œë“¤ì–´ì§„ ëª¨ë“ˆì„ ì›¹ì—ì„œ ë°›ì•„ì„œ ì„¤ì¹˜í•˜ê³  ê´€ë¦¬í•´ì£¼ëŠ” í”„ë¡œê·¸ë¨ì„
- npm installì€ package.jsonì— ì í˜€ìˆëŠ” ì¢…ì†ì„±ë“¤ì„ ì›¹ì—ì„œ ìë™ìœ¼ë¡œ ë‹¤ìš´ë°›ì•„ ì„¤ì¹˜í•´ì£¼ëŠ” ëª…ë ¹ì–´ì„
 
### Node serverë€?
- node + [entry file] ëª…ì„ ê¸°ë°˜ìœ¼ë¡œ ì•±ì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆìŒ

### `saveError ENOENT: no such file or directory, open '/package.json'`
### ì—ëŸ¬ ë°œìƒ ì›ì¸ì€?
- ë² ì´ìŠ¤ ì´ë¯¸ì§€ì˜ íŒŒì¼ ìŠ¤ëƒ…ìƒ·ì„ ì„ì‹œ ì»¨í…Œì´ë„ˆì˜ í•˜ë“œë””ìŠ¤í¬ì— ë„£ì–´ì¤Œ
- ê·¸ ì´í›„ npm installì„ ì§„í–‰
  - For ì–´í”Œë¦¬ì¼€ì´ì…˜ì— í•„ìš”í•œ ì¢…ì†ì„±ì„ ë‹¤ìš´ë°›ì•„ ì¤Œ
  - ë‹¤ìš´ë°›ì„ ë•Œ, package.jsonì„ ë³´ê³ , ê·¸ ê³³ì— ëª…ì‹œëœ ì¢…ì†ì„±ë“¤ì„ ë‹¤ìš´ë°›ì•„ì„œ ì„¤ì¹˜
- ê·¸ë•Œ package.jsonì´ í•´ë‹¹ ì„ì‹œ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ìˆì§€ ì•ŠìŒ
  
### package.jsonì„ ì„ì‹œì»¨í…Œì´ë„ˆ ë‚´ë¶€ë¡œ ì´ë™ì‹œì¼œì£¼ë ¤ë©´?
- `COPY package*.json ./`
  - package.json ğŸ‘‰ ë¡œì»¬ì— ìˆëŠ” íŠ¹ì • íŒŒì¼ == ë³µì‚¬í•  íŒŒì¼ ê²½ë¡œ
  - ./ ğŸ‘‰ ë„ì»¤ ì»¨í…Œì´ë„ˆì˜ ì§€ì • ì¥ì†Œì— ë³µì‚¬í•´ì£¼ê¸° == ì»¨í…Œì´ë„ˆë‚´ì—ì„œ íŒŒì¼ì´ ë³µì‚¬ë  ê²½ë¡œ

### ë™ì¼í•˜ê²Œ, server.jsë„ ë³µì‚¬í•´ì£¼ê¸°
> FROM node:10 <br>
COPY package*.json ./ <br> || ./ ./
RUN npm install <br>
CMD ["node", "server.js"] <br>

## ìƒì„±í•œ ì´ë¯¸ì§€ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œ ì ‘ê·¼ì´ ì•ˆë˜ëŠ” ì´ìœ 
### ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ëª…ë ¹ì–´ ë°”ê¾¸ê¸°
- docker run ì´ë¯¸ì§€ ì´ë¦„
- `$ docker run -p 49160:8080 ì´ë¯¸ì§€ ì´ë¦„`
  - ë¡œì»¬ íŒŒì¼(package.json, index.js)ì„ ì»¨í…Œì´ë„ˆì— ë³µì‚¬í•´ì¤Œ
  - ë„¤íŠ¸ì›Œí¬ë„ ë§ˆì°¬ê°€ì§€ë¡œ ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ì— ìˆë˜ ê²ƒì„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ìˆëŠ” ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°ì‹œì¼œì£¼ì–´ì•¼í•¨
- ![Image]({{ site.baseurl }}/images/docker_network.png)<br>
  - ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ 8080ì´ë¼ëŠ” í¬íŠ¸ì— ë°”ë¡œ ì ‘ê·¼í•˜ë ¤ë©´ ë§¤í•‘ì„ í•´ì£¼ì–´ì•¼ í•¨
  - 49160ì€ ë¡œì»¬ ë¸Œë¼ìš°ì €ì˜ í¬íŠ¸ë¡œ ê°€ë©´, ì»¨í…Œì´ë„ˆì˜ 8080ìœ¼ë¡œ ë§¤í•‘ë¨

## Working Directory ëª…ì‹œí•˜ê¸°
### Working Directoryë€?
- ì´ë¯¸ì§€ì•ˆì—ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ê°€ì§€ê³  ìˆì„ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒ
- ì´ ë””ë ‰í† ë¦¬ê°€ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ working directoryê°€ ë¨

### Working Directoryë¥¼ ì„¤ì •í•˜ì§€ ì•Šê³  COPYë¥¼ í–ˆì„ ë•Œ, ë¬¸ì œì 
1. COPYí•  íŒŒì¼ì˜ ì´ë¦„ì´ ê¸°ì¡´ íŒŒì¼ì‹œìŠ¤í…œì˜ ì´ë¦„ê³¼ ë™ì¼í•˜ë‹¤ë©´?
   - copyí•˜ëŠ” íŒŒì¼ì´ ê¸°ì¡´ íŒŒì¼ì„ ë®ì–´ì”Œì›€
2. ì •ë¦¬ê°€ ë˜ì§€ ì•ŠìŒ

### Working Directory ì„¤ì • 
> FROM node:10  <br>
WORKDIR usr/src/app <br>
RUN npm install  <br>
CMD ["node", "server.js"]  <br>

- ê¸°ì¡´ ì»¨í…Œì´ë„ˆì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ìˆëŠ” ê²ƒì„ ë³´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼
- `$ docker run -it <ì´ë¯¸ì§€ ì´ë¦„> bash/sh/zsh`ì‹œ working directory ë‚´ë¶€ë¡œ ë°”ë¡œ ì´ë™í•¨

<!-- ## ì–´í”Œë¦¬ì¼€ì´ì…˜ ì†ŒìŠ¤ ë³€ê²½ìœ¼ë¡œ ë‹¤ì‹œ ë¹Œë“œí•˜ëŠ” ê²ƒì— ëŒ€í•œ ë¬¸ì œì  -->
## ë„ì»¤ë¥¼ ì´ìš©í•´ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ì†ŒìŠ¤ê°€ ë°˜ì˜ì‹œí‚¤ëŠ” ë²•
### í˜„ì¬ê¹Œì§€ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ìˆœì„œ
1. ë„ì»¤ íŒŒì¼ ì‘ì„±
2. `$ docker build` : ë„ì»¤ íŒŒì¼ë¡œ ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±
3. `$ docker run` : ë„ì»¤ ì´ë¯¸ì§€ë¡œ ì»¨í…Œì´ë„ˆ ìƒì„± í›„ ì•± ì‹¤í–‰
- ë³€ê²½ëœ íŒŒíŠ¸ë¥¼ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì ìš©ì‹œí‚¤ë ¤ë©´ 2,3 êµ¬ê°„ ì „ì²´ë¥¼ ë‹¤ì‹œ ì‹¤í–‰ì‹œì¼œì•¼ í•¨


- `$docker run -d -p 5000:8080 <ì´ë¯¸ì§€ ì´ë¦„>`
- d : detach ì˜ ì¤„ì„ë§
- ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í›„ ë°”ë¡œ í„°ë¯¸ë„ì—ì„œ ë¹ ì ¸ë‚˜ì˜¤ê¸°

### ì–´í”Œë¦¬ì¼€ì´ì…˜ ì†ŒìŠ¤ ë³€ê²½ìœ¼ë¡œ ì¬ë¹Œë“œ íš¨ìœ¨ì ìœ¼ë¡œ í•˜ëŠ”ë²•
- `COPY ./ ./` -> `COPY package.json ./`
- ì¢…ì†ì„±ì„ ë”°ë¡œ ì¹´í”¼í•¨ìœ¼ë¡œ ìºì‹œë¥¼ ì´ìš©í•´ì„œ ë¹ ë¥´ê²Œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•¨

## Docker Volumes
### Docker Volumeì´ë€?
- ![Image]({{ site.baseurl }}/images/docker_volume.png)<br>
- COPY ë¥¼ ì ìš©í•˜ë©´, ë¡œì»¬ì˜ íŒŒì¼ì„ ì»¨í…Œì´ë„ˆë¡œ!
- ë³¼ë¥¨ì„ ì´ìš©í•˜ë©´, ë„ì»¤ ì»¨í…Œì´ë„ˆì—ì„œ ê³„ì† ë¡œì»¬ì˜ íŒŒì¼ì„ ë°”ë¼ë³´ê³ (ë§¤í•‘) ìˆìŒ
- **ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ì§€ ì•Šê³ , RUNë§Œìœ¼ë¡œ ë³€ê²½ëœ ì½”ë“œë¥¼ ì ìš©ì‹œí‚¬ ìˆ˜ ìˆìŒ**

### Volumeì„ ì‚¬ìš©í•´ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
- `$ docker run -p 5000:8080 -v /usr/src/app/node_modules -v $(pwd):/usr/src/app <ì´ë¯¸ì§€ ì•„ì´ë””>` 
- `-v /usr/src/app/node_modules`
  - í˜¸ìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ì— node_modulesëŠ” ì—†ê¸°ì— ì»¨í…Œì´ë„ˆì— ë§µí•‘ì„ í•˜ì§€ ë§ë¼ê³  í•˜ëŠ” ê²ƒ
- `-v $(pwd):/usr/src/app`
  - pwd ê²½ë¡œì— ìˆëŠ” ë””ë ‰í† ë¦¬ í˜¹ì€ íŒŒì¼ì„ /usr/src/app ê²½ë¡œì—ì„œ ì°¸ì¡°
  - pwd :: print working directory
    - í˜„ì¬ ì‘ì—…ì¤‘ì¸ ë””ë ‰í† ë¦¬ì˜ ì´ë¦„ì„ ì¶œë ¥í•˜ëŠ”ë° ì“°ì„
  


